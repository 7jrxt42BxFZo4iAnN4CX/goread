<!DOCTYPE html>
<html lang="en" ng-app>
<head>
	<title>Go Read</title>
	<link href="{{.BootstrapCss}}" rel="stylesheet">
	<style>
		.ng-cloak {
			display: none;
		}
		body {
			padding-top: 40px;
		}
		.hand {
			cursor: hand;
			cursor: pointer;
		}
		.story {
			border-bottom: 1px solid black;
		}
		.story-title {
			margin: 0;
		}
		.top-margin {
			margin-top: 20px;
		}
	</style>
	<link rel="shortcut icon" href="/static/favicon.png">
</head>
<body ng-controller="GoreadCtrl" class="ng-cloak">
	<div class="navbar navbar-inverse navbar-fixed-top">
		<div class="navbar-inner">
			<div class="container-fluid">
				<a class="brand" href="{{url "main"}}">go read</a>
				<ul class="nav">
					<li ng-class="{active: shown == 'about'}"><a href="#" ng-click="shown = 'about'">about</a></li>
				{{if .User}}
					<li ng-class="{active: shown == 'feeds'}" ng-init="shown = 'feeds'"><a href="#" ng-click="shown = 'feeds'">feeds</a></li>
					<li>
						<a href="#" ng-click="shown = 'feeds'">{{`{{unread() || 'no'}}`}} unread items</a>
					</li>
					<li>
						<form class="navbar-form">
							<button
								id="mark-all-read"
								class="btn btn-inverse"
								ng-click="markAllRead()"
								data-url="{{url "mark-all-read"}}"
								data-url-read="{{url "mark-read"}}"
								data-url-contents="{{url "get-contents"}}"
								>mark all as read</button>
							<button
								id="refresh"
								class="btn btn-inverse"
								ng-click="refresh()"
								data-url-feeds="{{url "list-feeds"}}"
								><i class="icon-refresh icon-white"></i></button>
							<button class="btn btn-inverse" ng-click="next()"><i class="icon-chevron-down icon-white"></i></button>
							<button class="btn btn-inverse" ng-click="prev()"><i class="icon-chevron-up icon-white"></i></button>
						</form>
					</li>
					<li><a ng-show="loading">loading...</a></li>
				{{end}}
				</ul>
				<ul class="nav pull-right">
					<li class="dropdown">
					{{if .User}}
						<a href="#" class="dropdown-toggle" data-toggle="dropdown">
							{{.User}}
							<b class="caret"></b>
						</a>
						<ul class="dropdown-menu">
							<li><a href="{{url "import-reader"}}">import google reader</a></li>
							<li><a href="#" ng-click="shown = 'add-subscription'">add subscription</a></li>
							<li><a href="#" ng-click="shown = 'import-opml'">import opml</a></li>
							<li class="divider"></li>
							<li><a href="{{url "logout"}}">logout</a></li>
						</ul>
					{{else}}
						<a href="#" class="dropdown-toggle" data-toggle="dropdown">
							log in / sign up
							<b class="caret"></b>
						</a>
						<ul class="dropdown-menu">
							<li><a href="{{url "login-google"}}">with google</a></li>
						</ul>
					{{end}}
					</li>
				</ul>
			</div>
		</div>
	</div>
	<div class="container-fluid">
		<div class="row-fluid top-margin" ng-show="shown == 'about'">
			<div class="offset3 span6">
				<h1>About</h1>
				<p>Go Read is a web-based RSS reader.</p>
				<p>It is designed to be exactly as useful as Google Reader and no more.</p>
				<p>
					Built by <a href="http://mattjibson.com">Matt Jibson</a>.
					Runs on <a href="https://developers.google.com/appengine/">Google App Engine</a>.
					Powered by <a href="http://golang.org/">Go</a> and <a href="http://angularjs.org/">AngularJS</a>.
					Code on <a href="https://github.com/mjibson/goread">GitHub</a>.
				</p>
			</div>
		</div>

		{{if .User}}
		<div class="row-fluid" ng-init="refresh()">
			<div ng-show="nav" class="span2">
				<ul class="unstyled">
					<li ng-repeat="(k, f) in feeds">
						{{`{{f.Feed.Title}}`}}
					</li>
				</ul>
			</div>

			<div ng-show="loading == 0 && shown == 'feeds' && numfeeds" ng-class="navspan()" ng-style="navmargin()">
				<div ng-repeat="s in stories" class="story" ng-mouseover="getContents(s)" id="storydiv{{`{{$index}}`}}">
					<div class="row-fluid">
						<div class="span2 hand" ng-click="setCurrent($index)" ng-bind="s.feed.Title"></div>
						<div class="span8" ng-click="setCurrent($index)">
							<strong class="hand" ng-bind="s.Title"></strong>
							<span class="hand" ng-show="s.Summary" ng-bind="'- ' + s.Summary"></span>
						</div>
						<div class="span2 text-right">
							<span class="hand" ng-click="setCurrent($index)" ng-bind="s.dispdate"></span>
							<a ng-href="{{`{{s.Link}}`}}" target="_blank"><i class="icon-share-alt"></i></a>
						</div>
						<div class="row-fluid" ng-show="$index == currentStory">
							<div class="span12">
								<h3 class="story-title"><a ng-href="{{`{{s.Link}}`}}" target="_blank" ng-bind="s.Title"></a></h3>
								<p><small>
									from <a ng-href="{{`{{s.feed.Link}}`}}" ng-bind="s.feed.Title" target="_blank"></a>
									<span ng-show="s.Author">by {{`{{s.Author}}`}}</span>
								</small></p>
								<p id="story{{`{{$index}}`}}"></p>
							</div>
						</div>
					</div>
				</div>
				<div ng-show="loading == 0 && shown == 'feeds' && numfeeds && stories.length == 0" class="row-fluid top-margin">
					<div class="offset2 span8">
						<div class="hero-unit">
							<p class="text-center">You've read all the things.</p>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div ng-show="nothing()" class="row-fluid top-margin">
			<div class="offset2 span8">
				<p>You don't have any feeds.</p>
				<p>You should probably add some.</p>
				<p><a href="{{url "import-reader"}}">Import from Google Reader.</a></p>
			</div>
		</div>

		<div class="row-fluid top-margin" ng-show="shown == 'add-subscription' || nothing()">
			<div class="offset2 span8">
				<form id="add-subscription-form" data-url="{{url "add-subscription"}}">
					<fieldset>
						<legend>Feed URL (RSS or Atom)</legend>
						<input type="text" class="span12" ng-model="addFeedUrl">
						<p><button ng-click="addSubscription()" class="btn">import</button></p>
					</fieldset>
				</form>
			</div>
		</div>

		<div class="row-fluid top-margin" ng-show="shown == 'import-opml' || nothing()">
			<div class="offset2 span8">
				<form id="import-opml-form" enctype="multipart/form-data" method="POST" action="{{url "import-opml"}}">
					<fieldset>
						<legend>Upload OPML file</legend>
						<input type="file" name="file">
						<p><button ng-click="importOpml()" type="submit" class="btn">upload</button></p>
					</fieldset>
				</form>
			</div>
		</div>
		{{else}}
			<div class="row-fluid top-margin" ng-init="nouser = true">
				<div class="offset1 span10" ng-hide="shown">
					<div class="hero-unit">
						<h1>Hi, RSS user</h1>
						<p>Go Read is a web-based RSS reader.</p>
						<p>It is designed to be exactly as useful as the old Google Reader and no more.</p>
						<p><a class="btn btn-primary btn-large" href="{{url "login-google"}}">sign up with google</a></p>
					</div>
				</div>
			</div>
		{{end}}
	</div>

	<div id="shortcuts" class="modal hide">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal">&times;</button>
			<h4>keyboard shortcuts</h4>
		</div>
		<div class="modal-body">
			<ul class="unstyled">
				<li><button class="btn btn-small">j/k</button> next/previous item</li>
				<li><button class="btn btn-small">r</button> refresh</li>
				<li><button class="btn btn-small">v</button> view original</li>
				<li><button class="btn btn-small">&lt;Shift&gt; + a</button> mark all as read</li>
				<li><button class="btn btn-small">a</button> add subscription</li>
				<li><button class="btn btn-small">g</button> then <button class="btn btn-small">a</button> go to all items</li>
				<li><button class="btn btn-small">u</button> hides/unhides the left hand side module</li>
			</ul>
		</div>
	</div>

	<script src="{{.Jquery}}"></script>
	<script src="{{.BootstrapJs}}"></script>
	<script src="/static/js/jquery.form.js"></script>
	<script src="/static/js/mousetrap.min.js"></script>
	<script src="{{.Angular}}"></script>
	<script src="/static/js/site.js"></script>

	{{.MiniProfiler}}
</body>
</html>
